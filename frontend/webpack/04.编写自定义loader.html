<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>4.编写自定义loader | 雪山之巅</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="apple-touch-icon" href="/jerry.github.io/apple-touch-icon.png">
    <link rel="icon" href="/jerry.github.io/favicon.ico">
    <link rel="manifest" href="/jerry.github.io/manifest.json">
    <meta name="description" content="我与夏风皆过客1">
    <meta name="theme-color" content="#ffffff">
    
    <link rel="preload" href="/jerry.github.io/assets/css/0.styles.ba9d0c50.css" as="style"><link rel="preload" href="/jerry.github.io/assets/js/app.8cb867ca.js" as="script"><link rel="preload" href="/jerry.github.io/assets/js/2.7d547363.js" as="script"><link rel="preload" href="/jerry.github.io/assets/js/11.230bdafc.js" as="script"><link rel="preload" href="/jerry.github.io/assets/js/20.cf42ebc2.js" as="script"><link rel="prefetch" href="/jerry.github.io/assets/js/10.a1c8416b.js"><link rel="prefetch" href="/jerry.github.io/assets/js/100.504935d6.js"><link rel="prefetch" href="/jerry.github.io/assets/js/101.21e817bf.js"><link rel="prefetch" href="/jerry.github.io/assets/js/102.65169271.js"><link rel="prefetch" href="/jerry.github.io/assets/js/103.6fcbe2c9.js"><link rel="prefetch" href="/jerry.github.io/assets/js/104.11583416.js"><link rel="prefetch" href="/jerry.github.io/assets/js/105.151c8c59.js"><link rel="prefetch" href="/jerry.github.io/assets/js/106.5363313f.js"><link rel="prefetch" href="/jerry.github.io/assets/js/107.b871dbb1.js"><link rel="prefetch" href="/jerry.github.io/assets/js/108.3c9edfb6.js"><link rel="prefetch" href="/jerry.github.io/assets/js/109.a2864e45.js"><link rel="prefetch" href="/jerry.github.io/assets/js/110.a19fcc30.js"><link rel="prefetch" href="/jerry.github.io/assets/js/111.093fdfd1.js"><link rel="prefetch" href="/jerry.github.io/assets/js/112.10ea3de4.js"><link rel="prefetch" href="/jerry.github.io/assets/js/113.95e556d2.js"><link rel="prefetch" href="/jerry.github.io/assets/js/114.bab0361c.js"><link rel="prefetch" href="/jerry.github.io/assets/js/115.a9cf132f.js"><link rel="prefetch" href="/jerry.github.io/assets/js/116.da97d300.js"><link rel="prefetch" href="/jerry.github.io/assets/js/117.36250871.js"><link rel="prefetch" href="/jerry.github.io/assets/js/118.e52f5780.js"><link rel="prefetch" href="/jerry.github.io/assets/js/119.7758e874.js"><link rel="prefetch" href="/jerry.github.io/assets/js/12.8cade74a.js"><link rel="prefetch" href="/jerry.github.io/assets/js/120.8f88acbb.js"><link rel="prefetch" href="/jerry.github.io/assets/js/121.6dcee880.js"><link rel="prefetch" href="/jerry.github.io/assets/js/122.8777c1e2.js"><link rel="prefetch" href="/jerry.github.io/assets/js/123.16bc758e.js"><link rel="prefetch" href="/jerry.github.io/assets/js/124.f8f1ed86.js"><link rel="prefetch" href="/jerry.github.io/assets/js/125.b4d23aeb.js"><link rel="prefetch" href="/jerry.github.io/assets/js/126.29d9ca54.js"><link rel="prefetch" href="/jerry.github.io/assets/js/127.cfe3a252.js"><link rel="prefetch" href="/jerry.github.io/assets/js/128.e7ab0c95.js"><link rel="prefetch" href="/jerry.github.io/assets/js/129.d0cac2ec.js"><link rel="prefetch" href="/jerry.github.io/assets/js/13.f32bffef.js"><link rel="prefetch" href="/jerry.github.io/assets/js/130.53ae1e24.js"><link rel="prefetch" href="/jerry.github.io/assets/js/131.b382f1b0.js"><link rel="prefetch" href="/jerry.github.io/assets/js/132.9f7a7079.js"><link rel="prefetch" href="/jerry.github.io/assets/js/133.9bedf5c8.js"><link rel="prefetch" href="/jerry.github.io/assets/js/134.0fde1402.js"><link rel="prefetch" href="/jerry.github.io/assets/js/135.8ce45018.js"><link rel="prefetch" href="/jerry.github.io/assets/js/136.165553e5.js"><link rel="prefetch" href="/jerry.github.io/assets/js/137.6e606b3c.js"><link rel="prefetch" href="/jerry.github.io/assets/js/138.21058c26.js"><link rel="prefetch" href="/jerry.github.io/assets/js/139.695a93ac.js"><link rel="prefetch" href="/jerry.github.io/assets/js/14.3eb5eb18.js"><link rel="prefetch" href="/jerry.github.io/assets/js/140.a9f8a3df.js"><link rel="prefetch" href="/jerry.github.io/assets/js/141.c7f4ec43.js"><link rel="prefetch" href="/jerry.github.io/assets/js/142.e5649d1a.js"><link rel="prefetch" href="/jerry.github.io/assets/js/143.1ee6e8a2.js"><link rel="prefetch" href="/jerry.github.io/assets/js/144.94acf2f4.js"><link rel="prefetch" href="/jerry.github.io/assets/js/145.eb5135d7.js"><link rel="prefetch" href="/jerry.github.io/assets/js/146.18f8a40e.js"><link rel="prefetch" href="/jerry.github.io/assets/js/147.b21fb0df.js"><link rel="prefetch" href="/jerry.github.io/assets/js/148.adfd1662.js"><link rel="prefetch" href="/jerry.github.io/assets/js/149.dc7e9bb0.js"><link rel="prefetch" href="/jerry.github.io/assets/js/15.5fbe3ada.js"><link rel="prefetch" href="/jerry.github.io/assets/js/150.f8fa379b.js"><link rel="prefetch" href="/jerry.github.io/assets/js/151.6f065a1f.js"><link rel="prefetch" href="/jerry.github.io/assets/js/152.1475f8d1.js"><link rel="prefetch" href="/jerry.github.io/assets/js/153.78885179.js"><link rel="prefetch" href="/jerry.github.io/assets/js/154.4047c70a.js"><link rel="prefetch" href="/jerry.github.io/assets/js/155.406967ab.js"><link rel="prefetch" href="/jerry.github.io/assets/js/156.751598e1.js"><link rel="prefetch" href="/jerry.github.io/assets/js/157.e7a7a219.js"><link rel="prefetch" href="/jerry.github.io/assets/js/158.d1ca1de8.js"><link rel="prefetch" href="/jerry.github.io/assets/js/159.93693f00.js"><link rel="prefetch" href="/jerry.github.io/assets/js/16.13e04a1e.js"><link rel="prefetch" href="/jerry.github.io/assets/js/160.4657154d.js"><link rel="prefetch" href="/jerry.github.io/assets/js/161.27b64c01.js"><link rel="prefetch" href="/jerry.github.io/assets/js/162.d58c457f.js"><link rel="prefetch" href="/jerry.github.io/assets/js/163.79343a4c.js"><link rel="prefetch" href="/jerry.github.io/assets/js/164.5a25522e.js"><link rel="prefetch" href="/jerry.github.io/assets/js/165.c52e5816.js"><link rel="prefetch" href="/jerry.github.io/assets/js/166.d5d598c8.js"><link rel="prefetch" href="/jerry.github.io/assets/js/167.82b2360f.js"><link rel="prefetch" href="/jerry.github.io/assets/js/168.88cc8b96.js"><link rel="prefetch" href="/jerry.github.io/assets/js/169.1cb9b389.js"><link rel="prefetch" href="/jerry.github.io/assets/js/17.283191f2.js"><link rel="prefetch" href="/jerry.github.io/assets/js/170.e3dcbc16.js"><link rel="prefetch" href="/jerry.github.io/assets/js/171.07ef11f3.js"><link rel="prefetch" href="/jerry.github.io/assets/js/172.c183eb41.js"><link rel="prefetch" href="/jerry.github.io/assets/js/173.59fc33e7.js"><link rel="prefetch" href="/jerry.github.io/assets/js/174.d37ec705.js"><link rel="prefetch" href="/jerry.github.io/assets/js/175.ab467af4.js"><link rel="prefetch" href="/jerry.github.io/assets/js/176.6d5f2e13.js"><link rel="prefetch" href="/jerry.github.io/assets/js/177.fd722926.js"><link rel="prefetch" href="/jerry.github.io/assets/js/178.901e44b1.js"><link rel="prefetch" href="/jerry.github.io/assets/js/179.95aecdf1.js"><link rel="prefetch" href="/jerry.github.io/assets/js/18.f812f6af.js"><link rel="prefetch" href="/jerry.github.io/assets/js/180.6f7205ee.js"><link rel="prefetch" href="/jerry.github.io/assets/js/181.7e1e1402.js"><link rel="prefetch" href="/jerry.github.io/assets/js/182.eb3c32f9.js"><link rel="prefetch" href="/jerry.github.io/assets/js/183.794272e9.js"><link rel="prefetch" href="/jerry.github.io/assets/js/184.3ed1d5af.js"><link rel="prefetch" href="/jerry.github.io/assets/js/185.2430ff76.js"><link rel="prefetch" href="/jerry.github.io/assets/js/186.46272a01.js"><link rel="prefetch" href="/jerry.github.io/assets/js/187.c617b164.js"><link rel="prefetch" href="/jerry.github.io/assets/js/19.f9e85296.js"><link rel="prefetch" href="/jerry.github.io/assets/js/21.724fc087.js"><link rel="prefetch" href="/jerry.github.io/assets/js/22.c6929093.js"><link rel="prefetch" href="/jerry.github.io/assets/js/23.f56ff06f.js"><link rel="prefetch" href="/jerry.github.io/assets/js/24.44ba2312.js"><link rel="prefetch" href="/jerry.github.io/assets/js/25.f35c5403.js"><link rel="prefetch" href="/jerry.github.io/assets/js/26.b731cd9b.js"><link rel="prefetch" href="/jerry.github.io/assets/js/27.3d5daa0a.js"><link rel="prefetch" href="/jerry.github.io/assets/js/28.8cc8bab9.js"><link rel="prefetch" href="/jerry.github.io/assets/js/29.7730d077.js"><link rel="prefetch" href="/jerry.github.io/assets/js/3.5ab0026b.js"><link rel="prefetch" href="/jerry.github.io/assets/js/30.6d37c03b.js"><link rel="prefetch" href="/jerry.github.io/assets/js/31.e8f4a77a.js"><link rel="prefetch" href="/jerry.github.io/assets/js/32.549d6f8e.js"><link rel="prefetch" href="/jerry.github.io/assets/js/33.95792b9f.js"><link rel="prefetch" href="/jerry.github.io/assets/js/34.b7e709b1.js"><link rel="prefetch" href="/jerry.github.io/assets/js/35.daed2e5c.js"><link rel="prefetch" href="/jerry.github.io/assets/js/36.90c3c71a.js"><link rel="prefetch" href="/jerry.github.io/assets/js/37.dfa11bd8.js"><link rel="prefetch" href="/jerry.github.io/assets/js/38.e36c7a27.js"><link rel="prefetch" href="/jerry.github.io/assets/js/39.017d9b19.js"><link rel="prefetch" href="/jerry.github.io/assets/js/4.7259a42f.js"><link rel="prefetch" href="/jerry.github.io/assets/js/40.e43eaee9.js"><link rel="prefetch" href="/jerry.github.io/assets/js/41.697e21b6.js"><link rel="prefetch" href="/jerry.github.io/assets/js/42.f01531a7.js"><link rel="prefetch" href="/jerry.github.io/assets/js/43.84df7d63.js"><link rel="prefetch" href="/jerry.github.io/assets/js/44.891e9a3f.js"><link rel="prefetch" href="/jerry.github.io/assets/js/45.f19e5ca4.js"><link rel="prefetch" href="/jerry.github.io/assets/js/46.f81f1bfa.js"><link rel="prefetch" href="/jerry.github.io/assets/js/47.8f4693a3.js"><link rel="prefetch" href="/jerry.github.io/assets/js/48.b0c93d91.js"><link rel="prefetch" href="/jerry.github.io/assets/js/49.f9f0f3f8.js"><link rel="prefetch" href="/jerry.github.io/assets/js/5.e04d3d1e.js"><link rel="prefetch" href="/jerry.github.io/assets/js/50.e03d13cd.js"><link rel="prefetch" href="/jerry.github.io/assets/js/51.f8825ce8.js"><link rel="prefetch" href="/jerry.github.io/assets/js/52.ec76efc3.js"><link rel="prefetch" href="/jerry.github.io/assets/js/53.c9a34637.js"><link rel="prefetch" href="/jerry.github.io/assets/js/54.8abbd387.js"><link rel="prefetch" href="/jerry.github.io/assets/js/55.c468aca8.js"><link rel="prefetch" href="/jerry.github.io/assets/js/56.f4b50a04.js"><link rel="prefetch" href="/jerry.github.io/assets/js/57.de666ddb.js"><link rel="prefetch" href="/jerry.github.io/assets/js/58.458d0401.js"><link rel="prefetch" href="/jerry.github.io/assets/js/59.40e6b3d1.js"><link rel="prefetch" href="/jerry.github.io/assets/js/6.c98e06b3.js"><link rel="prefetch" href="/jerry.github.io/assets/js/60.43848b9a.js"><link rel="prefetch" href="/jerry.github.io/assets/js/61.2fe1e137.js"><link rel="prefetch" href="/jerry.github.io/assets/js/62.3f176587.js"><link rel="prefetch" href="/jerry.github.io/assets/js/63.f552851c.js"><link rel="prefetch" href="/jerry.github.io/assets/js/64.d50a2fff.js"><link rel="prefetch" href="/jerry.github.io/assets/js/65.0d627c3b.js"><link rel="prefetch" href="/jerry.github.io/assets/js/66.78e14677.js"><link rel="prefetch" href="/jerry.github.io/assets/js/67.caf5006d.js"><link rel="prefetch" href="/jerry.github.io/assets/js/68.39e8b4be.js"><link rel="prefetch" href="/jerry.github.io/assets/js/69.bd962060.js"><link rel="prefetch" href="/jerry.github.io/assets/js/7.5838a81a.js"><link rel="prefetch" href="/jerry.github.io/assets/js/70.578ae89e.js"><link rel="prefetch" href="/jerry.github.io/assets/js/71.8c97f45c.js"><link rel="prefetch" href="/jerry.github.io/assets/js/72.d9e369a7.js"><link rel="prefetch" href="/jerry.github.io/assets/js/73.4b42860a.js"><link rel="prefetch" href="/jerry.github.io/assets/js/74.1a99cf28.js"><link rel="prefetch" href="/jerry.github.io/assets/js/75.58b36cd5.js"><link rel="prefetch" href="/jerry.github.io/assets/js/76.ed9de37a.js"><link rel="prefetch" href="/jerry.github.io/assets/js/77.227912ee.js"><link rel="prefetch" href="/jerry.github.io/assets/js/78.93f12412.js"><link rel="prefetch" href="/jerry.github.io/assets/js/79.81a03b40.js"><link rel="prefetch" href="/jerry.github.io/assets/js/8.4e52af96.js"><link rel="prefetch" href="/jerry.github.io/assets/js/80.b777d54f.js"><link rel="prefetch" href="/jerry.github.io/assets/js/81.0b43f0cc.js"><link rel="prefetch" href="/jerry.github.io/assets/js/82.28396efa.js"><link rel="prefetch" href="/jerry.github.io/assets/js/83.1277f065.js"><link rel="prefetch" href="/jerry.github.io/assets/js/84.8e6d03c2.js"><link rel="prefetch" href="/jerry.github.io/assets/js/85.2376dca3.js"><link rel="prefetch" href="/jerry.github.io/assets/js/86.555d125a.js"><link rel="prefetch" href="/jerry.github.io/assets/js/87.d6aee5d0.js"><link rel="prefetch" href="/jerry.github.io/assets/js/88.1737751f.js"><link rel="prefetch" href="/jerry.github.io/assets/js/89.e3d5e734.js"><link rel="prefetch" href="/jerry.github.io/assets/js/9.6a9d759a.js"><link rel="prefetch" href="/jerry.github.io/assets/js/90.f1b5cd88.js"><link rel="prefetch" href="/jerry.github.io/assets/js/91.87444e61.js"><link rel="prefetch" href="/jerry.github.io/assets/js/92.45ed101b.js"><link rel="prefetch" href="/jerry.github.io/assets/js/93.18f7d79e.js"><link rel="prefetch" href="/jerry.github.io/assets/js/94.efb5658f.js"><link rel="prefetch" href="/jerry.github.io/assets/js/95.1228ac2d.js"><link rel="prefetch" href="/jerry.github.io/assets/js/96.c1a66ad9.js"><link rel="prefetch" href="/jerry.github.io/assets/js/97.32033135.js"><link rel="prefetch" href="/jerry.github.io/assets/js/98.37b12cfd.js"><link rel="prefetch" href="/jerry.github.io/assets/js/99.cd7ac96d.js">
    <link rel="stylesheet" href="/jerry.github.io/assets/css/0.styles.ba9d0c50.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/jerry.github.io/" class="home-link router-link-active"><!----> <span class="site-name">雪山之巅</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/jerry.github.io/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端知识" class="dropdown-title"><span class="title">前端知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端知识" class="mobile-dropdown-title"><span class="title">前端知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/jerry.github.io/frontend/es6/" class="nav-link">
  ECMAScript6
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/frontend/typescript/" class="nav-link">
  TypeScript
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/frontend/webpack/.html" class="nav-link">
  ---------------
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/frontend/javascript/" class="nav-link">
  JS基础专题
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/frontend/jsTopic/" class="nav-link">
  JS技术专题
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/frontend/jsOpt/" class="nav-link">
  JS优化专题
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/frontend/webpack/.html" class="nav-link">
  ---------------
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/frontend/webpack/" class="nav-link router-link-active">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/frontend/webpack4/" class="nav-link">
  Webpack4配置实战
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/frontend/webpack/.html" class="nav-link">
  ---------------
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/frontend/web/" class="nav-link">
  浏览器相关
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/frontend/html/" class="nav-link">
  HTML5
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/frontend/css/" class="nav-link">
  CSS3
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/frontend/excellent/" class="nav-link">
  优秀博客
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架知识" class="dropdown-title"><span class="title">框架知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架知识" class="mobile-dropdown-title"><span class="title">框架知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/jerry.github.io/frameModule/vue/" class="nav-link">
  Vue3
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/frameModule/ReactNative/" class="nav-link">
  React Native
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/frameModule/weixin/" class="nav-link">
  微信小程序
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="服务端知识" class="dropdown-title"><span class="title">服务端知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="服务端知识" class="mobile-dropdown-title"><span class="title">服务端知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/jerry.github.io/backend/nodejs/" class="nav-link">
  NodeJS
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/backend/koa/" class="nav-link">
  Koa
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/backend/mysql/" class="nav-link">
  Mysql
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/backend/mongodb/" class="nav-link">
  MongoDB
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/backend/nginx/" class="nav-link">
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/backend/http/" class="nav-link">
  HTTP协议
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/backend/docker/" class="nav-link">
  官网知识推荐
</a></li></ul></div></div><div class="nav-item"><a href="/jerry.github.io/blog/" class="nav-link">
  其他杂谈
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/jerry.github.io/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端知识" class="dropdown-title"><span class="title">前端知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端知识" class="mobile-dropdown-title"><span class="title">前端知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/jerry.github.io/frontend/es6/" class="nav-link">
  ECMAScript6
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/frontend/typescript/" class="nav-link">
  TypeScript
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/frontend/webpack/.html" class="nav-link">
  ---------------
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/frontend/javascript/" class="nav-link">
  JS基础专题
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/frontend/jsTopic/" class="nav-link">
  JS技术专题
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/frontend/jsOpt/" class="nav-link">
  JS优化专题
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/frontend/webpack/.html" class="nav-link">
  ---------------
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/frontend/webpack/" class="nav-link router-link-active">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/frontend/webpack4/" class="nav-link">
  Webpack4配置实战
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/frontend/webpack/.html" class="nav-link">
  ---------------
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/frontend/web/" class="nav-link">
  浏览器相关
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/frontend/html/" class="nav-link">
  HTML5
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/frontend/css/" class="nav-link">
  CSS3
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/frontend/excellent/" class="nav-link">
  优秀博客
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架知识" class="dropdown-title"><span class="title">框架知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架知识" class="mobile-dropdown-title"><span class="title">框架知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/jerry.github.io/frameModule/vue/" class="nav-link">
  Vue3
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/frameModule/ReactNative/" class="nav-link">
  React Native
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/frameModule/weixin/" class="nav-link">
  微信小程序
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="服务端知识" class="dropdown-title"><span class="title">服务端知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="服务端知识" class="mobile-dropdown-title"><span class="title">服务端知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/jerry.github.io/backend/nodejs/" class="nav-link">
  NodeJS
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/backend/koa/" class="nav-link">
  Koa
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/backend/mysql/" class="nav-link">
  Mysql
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/backend/mongodb/" class="nav-link">
  MongoDB
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/backend/nginx/" class="nav-link">
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/backend/http/" class="nav-link">
  HTTP协议
</a></li><li class="dropdown-item"><!----> <a href="/jerry.github.io/backend/docker/" class="nav-link">
  官网知识推荐
</a></li></ul></div></div><div class="nav-item"><a href="/jerry.github.io/blog/" class="nav-link">
  其他杂谈
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Webpack</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/jerry.github.io/frontend/webpack/" aria-current="page" class="sidebar-link">首页</a></li><li><a href="/jerry.github.io/frontend/webpack/01.页面自动刷新配置和原理.html" class="sidebar-link">1. 页面自动刷新配置和原理</a></li><li><a href="/jerry.github.io/frontend/webpack/02.模块热替换配置和原理.html" class="sidebar-link">2. 模块热更新配置和原理</a></li><li><a href="/jerry.github.io/frontend/webpack/03.Tapable.html" class="sidebar-link">3.Tapable学习</a></li><li><a href="/jerry.github.io/frontend/webpack/04.编写自定义loader.html" class="active sidebar-link">4.编写自定义loader</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/jerry.github.io/frontend/webpack/04.编写自定义loader.html#函数组合的两种情况" class="sidebar-link">函数组合的两种情况</a></li><li class="sidebar-sub-header"><a href="/jerry.github.io/frontend/webpack/04.编写自定义loader.html#什么是loader" class="sidebar-link">什么是loader</a></li><li class="sidebar-sub-header"><a href="/jerry.github.io/frontend/webpack/04.编写自定义loader.html#loader特点" class="sidebar-link">loader特点</a></li><li class="sidebar-sub-header"><a href="/jerry.github.io/frontend/webpack/04.编写自定义loader.html#loader基础" class="sidebar-link">loader基础</a></li><li class="sidebar-sub-header"><a href="/jerry.github.io/frontend/webpack/04.编写自定义loader.html#初始化loader创建" class="sidebar-link">初始化loader创建</a></li><li class="sidebar-sub-header"><a href="/jerry.github.io/frontend/webpack/04.编写自定义loader.html#loader进阶" class="sidebar-link">loader进阶</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/jerry.github.io/frontend/webpack/04.编写自定义loader.html#使用loader-runner高效进行loader的调试" class="sidebar-link">使用loader-runner高效进行loader的调试</a></li><li class="sidebar-sub-header"><a href="/jerry.github.io/frontend/webpack/04.编写自定义loader.html#loader参数的获取-通过loader-utils" class="sidebar-link">loader参数的获取(通过loader-utils)</a></li><li class="sidebar-sub-header"><a href="/jerry.github.io/frontend/webpack/04.编写自定义loader.html#返回其它结果" class="sidebar-link">返回其它结果</a></li><li class="sidebar-sub-header"><a href="/jerry.github.io/frontend/webpack/04.编写自定义loader.html#loader返回值处理" class="sidebar-link">loader返回值处理</a></li><li class="sidebar-sub-header"><a href="/jerry.github.io/frontend/webpack/04.编写自定义loader.html#同步与异步" class="sidebar-link">同步与异步</a></li><li class="sidebar-sub-header"><a href="/jerry.github.io/frontend/webpack/04.编写自定义loader.html#同步loader异常处理" class="sidebar-link">同步loader异常处理</a></li></ul></li><li class="sidebar-sub-header"><a href="/jerry.github.io/frontend/webpack/04.编写自定义loader.html#处理二进制数据" class="sidebar-link">处理二进制数据</a></li><li class="sidebar-sub-header"><a href="/jerry.github.io/frontend/webpack/04.编写自定义loader.html#开启loader缓存加速" class="sidebar-link">开启loader缓存加速</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/jerry.github.io/frontend/webpack/04.编写自定义loader.html#loader如何进行文件输出" class="sidebar-link">loader如何进行文件输出？</a></li><li class="sidebar-sub-header"><a href="/jerry.github.io/frontend/webpack/04.编写自定义loader.html#其它loader-api" class="sidebar-link">其它Loader API</a></li></ul></li><li class="sidebar-sub-header"><a href="/jerry.github.io/frontend/webpack/04.编写自定义loader.html#_4种本地开发测试loader的方法-加载本地-loader" class="sidebar-link">4种本地开发测试loader的方法(加载本地 Loader)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/jerry.github.io/frontend/webpack/04.编写自定义loader.html#匹配单个loader-你可以简单通过在rule对象设置path-resolve指向这个本地文件" class="sidebar-link">匹配单个loader，你可以简单通过在rule对象设置path.resolve指向这个本地文件</a></li><li class="sidebar-sub-header"><a href="/jerry.github.io/frontend/webpack/04.编写自定义loader.html#匹配多个loaders-可以使用resolveloader-modules-配置" class="sidebar-link">匹配多个loaders，可以使用resolveLoader.modules 配置</a></li><li class="sidebar-sub-header"><a href="/jerry.github.io/frontend/webpack/04.编写自定义loader.html#resolveloader-alias" class="sidebar-link">resolveLoader.alias</a></li><li class="sidebar-sub-header"><a href="/jerry.github.io/frontend/webpack/04.编写自定义loader.html#使用npm-link" class="sidebar-link">使用npm link</a></li></ul></li><li class="sidebar-sub-header"><a href="/jerry.github.io/frontend/webpack/04.编写自定义loader.html#loader分类" class="sidebar-link">loader分类</a></li><li class="sidebar-sub-header"><a href="/jerry.github.io/frontend/webpack/04.编写自定义loader.html#配置多个loader" class="sidebar-link">配置多个loader</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/jerry.github.io/frontend/webpack/04.编写自定义loader.html#数组形式" class="sidebar-link">数组形式</a></li><li class="sidebar-sub-header"><a href="/jerry.github.io/frontend/webpack/04.编写自定义loader.html#对象形式-可以配置loader参数" class="sidebar-link">对象形式(可以配置loader参数)</a></li><li class="sidebar-sub-header"><a href="/jerry.github.io/frontend/webpack/04.编写自定义loader.html#多个loader执行顺序" class="sidebar-link">多个loader执行顺序</a></li><li class="sidebar-sub-header"><a href="/jerry.github.io/frontend/webpack/04.编写自定义loader.html#配置参数改变loader执行顺序" class="sidebar-link">配置参数改变loader执行顺序</a></li></ul></li><li class="sidebar-sub-header"><a href="/jerry.github.io/frontend/webpack/04.编写自定义loader.html#inline-loader-行内loader" class="sidebar-link">inline-loader(行内loader)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/jerry.github.io/frontend/webpack/04.编写自定义loader.html#禁用normal-loader" class="sidebar-link">!禁用normal-loader</a></li><li class="sidebar-sub-header"><a href="/jerry.github.io/frontend/webpack/04.编写自定义loader.html#禁用pre-loader和normal-loader" class="sidebar-link">-!禁用pre-loader和normal-loader</a></li><li class="sidebar-sub-header"><a href="/jerry.github.io/frontend/webpack/04.编写自定义loader.html#禁用pre-loader、normal-loader、post-loader-只能行内处理" class="sidebar-link">!!禁用pre-loader、normal-loader、post-loader，只能行内处理</a></li></ul></li><li class="sidebar-sub-header"><a href="/jerry.github.io/frontend/webpack/04.编写自定义loader.html#loader组成" class="sidebar-link">loader组成</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/jerry.github.io/frontend/webpack/04.编写自定义loader.html#所有loader均无返回值" class="sidebar-link">所有loader均无返回值</a></li><li class="sidebar-sub-header"><a href="/jerry.github.io/frontend/webpack/04.编写自定义loader.html#有pitchloader存在返回值" class="sidebar-link">有pitchLoader存在返回值</a></li></ul></li><li class="sidebar-sub-header"><a href="/jerry.github.io/frontend/webpack/04.编写自定义loader.html#loader-runner" class="sidebar-link">loader-runner</a></li><li class="sidebar-sub-header"><a href="/jerry.github.io/frontend/webpack/04.编写自定义loader.html#实战" class="sidebar-link">实战</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/jerry.github.io/frontend/webpack/04.编写自定义loader.html#raw-loader" class="sidebar-link">raw-loader</a></li></ul></li><li class="sidebar-sub-header"><a href="/jerry.github.io/frontend/webpack/04.编写自定义loader.html#参考文档" class="sidebar-link">参考文档</a></li></ul></li><li><a href="/jerry.github.io/frontend/webpack/05.编写自定义plugin.html" class="sidebar-link">5.编写自定义plugin</a></li><li><a href="/jerry.github.io/frontend/webpack/06.提升Webpack打包速度.html" class="sidebar-link">6.提升Webpack打包速度</a></li><li><a href="/jerry.github.io/frontend/webpack/07.模块分析.html" class="sidebar-link">7. Webpack模块打包分析</a></li><li><a href="/jerry.github.io/frontend/webpack/08.Webpack打包流程分析.html" class="sidebar-link">8.Webpack打包流程分析</a></li><li><a href="/jerry.github.io/frontend/webpack/09.HMR热更新原理.html" class="sidebar-link">9. HMR热更新原理</a></li><li><a href="/jerry.github.io/frontend/webpack/10.Webpack最易混淆的点.html" class="sidebar-link">10. Webpack最易混淆的点</a></li><li><a href="/jerry.github.io/frontend/webpack/11.手写webpack.html" class="sidebar-link">11. 手写Webpack</a></li><li><a href="/jerry.github.io/frontend/webpack/12.常用loader实现.html" class="sidebar-link">12. 常用loader实现</a></li><li><a href="/jerry.github.io/frontend/webpack/13.webpack启动过程分析.html" class="sidebar-link">13. webpack启动过程分析</a></li><li><a href="/jerry.github.io/frontend/webpack/14.Webpack4.x配置总结.html" class="sidebar-link">14. Webpack4.x 配置</a></li><li><a href="/jerry.github.io/frontend/webpack/Webpack原理.html" class="sidebar-link">Webpack原理</a></li><li><a href="/jerry.github.io/frontend/webpack/http.html" class="sidebar-link">/frontend/webpack/http.html</a></li><li><a href="/jerry.github.io/frontend/webpack/http-proxy-middleware.html" class="sidebar-link">http-proxy-middleware</a></li><li><a href="/jerry.github.io/frontend/webpack/前端工程化.html" class="sidebar-link">前端工程化</a></li><li><a href="/jerry.github.io/frontend/webpack/编写可维护的webpack构建配置.html" class="sidebar-link">编写可维护的webpack构建配置</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>[TOC]
原则上webpack只能处理js模块，如果要处理其他类型的文件，需要使用对应的loader进行转换处理。</p> <p>举个🌰：处理SCSS文件</p> <ul><li>先将SCSS源代码提交给sass-loader，将SCSS转换成CSS；</li> <li>将sass-loader输出的CSS提交给css-loader处理，找出CSS中依赖的资源、压缩CSS等；</li> <li>将css-loader输出的CSS提交给style-loader处理，转换成通过脚本加载的JavaScript代码；</li></ul> <p>Webpack相关配置如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token comment">// 增加对 SCSS 文件的支持</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.scss$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token comment">// SCSS文件的处理顺序为先sass-loader，再css-loader，再style-loader</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
            <span class="token comment">// 给css-loader传入配置项</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">minimize</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token string">'sass-loader'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>可以看出，以上处理过程需要有顺序的链式执行，先sass-loader，再css-loader，再style-loader。是<strong>从后向前</strong>依次执行对应的loader，那么为什么loader的执行顺序是从后向前的呢？这就要说到函数组合了。</p> <h2 id="函数组合的两种情况"><a href="#函数组合的两种情况" class="header-anchor">#</a> 函数组合的两种情况</h2> <ul><li>Unix中的pipline：执行顺序是<strong>从左往右</strong></li> <li>函数组合Compose(webpack采用的就是这种)：执行顺序是<strong>从右往左</strong></li></ul> <h2 id="什么是loader"><a href="#什么是loader" class="header-anchor">#</a> 什么是loader</h2> <p>loader是webpack中一个重要的概念，用来将一段代码转换成另一段代码的webpack加载器。<strong>loader本质上就是导出为一个函数的node模块，该函数在loader转换资源的时候调用</strong>。给定的函数将调用loader API，并通过this上下文访问。loader就像是一个翻译员，能将源文件经过转化后输出新的结果，并且一个文件还可以链式地经过多个翻译员翻译。</p> <h2 id="loader特点"><a href="#loader特点" class="header-anchor">#</a> loader特点</h2> <ul><li>第一个loader要返回js脚本</li> <li>每个loader的职责是单一的，即只做一件事(只需要完成一种转换)</li> <li>每一个loader都是一个Node模块</li> <li>每个loader都是无状态的，确保loader在不同模块转换之间不保存状态</li></ul> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>需要注意：在开发一个loader时，请保持其<strong>职责的单一性</strong>，我们只需关心输入和输出。如果一个源文件需要经历多步转换才能正常使用，就通过多个loader去转换。 在调用多个loader`转换一个文件时，每个loader都会链式地顺序执行。第一个loader将会拿到需处理的原内容，上一个loader处理后的结果会被传给下一个loader接着处理，最后的loader将处理后的最终结果返回给Webpack。</p></div> <h2 id="loader基础"><a href="#loader基础" class="header-anchor">#</a> loader基础</h2> <p>Webpack是运行在Node.js之上的，<strong>一个loader其实就是一个Node.js模块</strong>，这个模块需要导出一个函数。这个导出函数的工作就是：获得处理前的原内容，对原内容执行处理后，返回处理后的内容。</p> <p>一个最简单的loader的源码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// source为compiler传递给loader的一个文件的原内容</span>
  <span class="token comment">// 该函数需要返回处理后的内容，这里为了简单起见，直接把原内容返回了，相当于该loader没有做任何转换</span>
  <span class="token keyword">return</span> source<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>由于loader运行在Nodejs中，所以我们可以调用任意Nodejs自带的API，或者安装第三方模块进行调用：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> sass <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'node-sass'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">sass</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="初始化loader创建"><a href="#初始化loader创建" class="header-anchor">#</a> 初始化loader创建</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 先安装webpack-cli</span>
webpack<span class="token operator">-</span>cli generate<span class="token operator">-</span>loader
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="loader进阶"><a href="#loader进阶" class="header-anchor">#</a> loader进阶</h2> <p>以上只是个最简单的loader，Webpack还提供一些API供loader调用，下面来一一介绍：</p> <h3 id="使用loader-runner高效进行loader的调试"><a href="#使用loader-runner高效进行loader的调试" class="header-anchor">#</a> 使用loader-runner高效进行loader的调试</h3> <p><code>loader-runner</code>允许我们在不安装webpack的情况下运行loaders。
作用：</p> <ul><li>作为webpack的依赖，webpack中使用它执行loader；</li> <li>进行loader的开发和调试。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>runLoaders<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'loader-runner'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">runLoaders</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">resource</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./src/demo.txt'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">loaders</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./src/raw-loader.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// loader参数</span>
                <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'test-loader'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">context</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">emitFile</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">readResource</span><span class="token operator">:</span> fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>fs<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>resourceBuffer<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// foobar</span>
    err <span class="token operator">?</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">:</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// result的内容：</span>
<span class="token comment">/*
{ result: [ 'export default &quot;bar&quot;' ], // loader执行结果
  resourceBuffer: &lt;Buffer 66 6f 6f 62 61 72&gt;,
  cacheable: true, // 结果是否被缓存
  fileDependencies:
   [ '/Users/liujie26/geektime-webpack-course/code/chapter07/raw-loader/src/demo.txt' ],
  contextDependencies: [] }
*/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h3 id="loader参数的获取-通过loader-utils"><a href="#loader参数的获取-通过loader-utils" class="header-anchor">#</a> loader参数的获取(通过loader-utils)</h3> <p>在最上面处理SCSS文件的Webpack配置中，将options参数传给了css-loader，以控制css-loader。如何在自己编写的Loader中获取到用户传入的options呢？需要这样做：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> loaderUtils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'loader-utils'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 获取用户为当前Loader传入的options</span>
  <span class="token keyword">const</span> options <span class="token operator">=</span> loaderUtils<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> source<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="返回其它结果"><a href="#返回其它结果" class="header-anchor">#</a> 返回其它结果</h3> <p>上面的loader都只是返回了原内容转换后的内容，但在某些场景下还需要返回除了内容之外的东西。</p> <p>以用babel-loader转换ES6代码为例，它还需要输出转换后的ES5代码对应的Source Map，以方便调试源码。为了将Source Map也一起随着ES5 代码返回给Webpack，可以这样写：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 通过 this.callback 告诉 Webpack 返回的结果</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> source<span class="token punctuation">,</span> sourceMaps<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 当我们使用 this.callback 返回内容时，该 Loader 必须返回 undefined，</span>
  <span class="token comment">// 以让 Webpack 知道该 Loader 返回的结果在 this.callback 中，而不是 return 中</span>
  <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>其中的<code>this.callback</code>是 Webpack 给 Loader 注入的 API，以方便 Loader 和 Webpack 之间通信。<code>this.callback</code>的详细使用方法如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span>
    <span class="token comment">// 当无法转换原内容时，给 Webpack 返回一个 Error</span>
    <span class="token literal-property property">err</span><span class="token operator">:</span> Error <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token comment">// 原内容转换后的内容</span>
    <span class="token literal-property property">content</span><span class="token operator">:</span> string <span class="token operator">|</span> Buffer<span class="token punctuation">,</span>
    <span class="token comment">// 用于把转换后的内容得出原内容的 Source Map，方便调试</span>
    sourceMap<span class="token operator">?</span><span class="token operator">:</span> SourceMap<span class="token punctuation">,</span>
    <span class="token comment">// 如果本次转换为原内容生成了 AST 语法树，可以把这个 AST 返回，</span>
    <span class="token comment">// 以方便之后需要 AST 的 Loader 复用该 AST，以避免重复生成 AST，提升性能</span>
    abstractSyntaxTree<span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">AST</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><code>Source Map</code>的生成很耗时，通常在开发环境下才会生成<code>Source Map</code>，其他环境下不用生成，以加速构建。因此，Webpack为Loader提供了 this.sourceMap API去告诉<code>Loader</code>当前构建环境下用户是否需要 Source Map。如果我们编写的Loader会生成Source Map，请考虑到这点。</p> <h3 id="loader返回值处理"><a href="#loader返回值处理" class="header-anchor">#</a> loader返回值处理</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">export default </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>json<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token comment">// loader返回一个值的话可以采用return的方式</span>
<span class="token comment">// 如果要返回多个值的话就需要采用this.callback的方式了</span>
<span class="token comment">// this.callback(null, json, 2, 3, 4);</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="同步与异步"><a href="#同步与异步" class="header-anchor">#</a> 同步与异步</h3> <p>Loader有同步和异步之分，上面介绍的Loader都是同步的Loader，因为它们的转换流程都是同步的，转换完成后再返回结果。但在某些场景下转换的步骤只能是异步完成的，例如：我们需要通过网络请求才能得出结果，如果采用同步的方式，则网络请求会阻塞整个构建，导致构建非常缓慢。</p> <p>如果是异步转换，我们可以这样：通过this.async来返回一个异步函数。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 告诉 Webpack 本次转换是异步的，Loader 会在 callback 中回调结果</span>
    <span class="token keyword">var</span> callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">someAsyncOperation</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result<span class="token punctuation">,</span> sourceMaps<span class="token punctuation">,</span> ast</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 通过 callback 返回异步执行后的结果</span>
        <span class="token comment">// callback是this.async返回的异步函数</span>
        <span class="token comment">// 第一个参数是Error，第二个参数是处理的结果</span>
        <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> result<span class="token punctuation">,</span> sourceMaps<span class="token punctuation">,</span> ast<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="同步loader异常处理"><a href="#同步loader异常处理" class="header-anchor">#</a> 同步loader异常处理</h3> <ul><li>loader内直接通过throw抛出</li> <li>通过this.callback传递错误</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span>
    <span class="token literal-property property">err</span><span class="token operator">:</span> Error <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token literal-property property">content</span><span class="token operator">:</span> string <span class="token operator">|</span> Buffer<span class="token punctuation">,</span>
    sourceMap<span class="token operator">?</span><span class="token operator">:</span> SourceMap<span class="token punctuation">,</span>
    meta<span class="token operator">?</span><span class="token operator">:</span> any
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="处理二进制数据"><a href="#处理二进制数据" class="header-anchor">#</a> 处理二进制数据</h2> <p>在默认的情况下，Webpack传给Loader的原内容都是UTF-8格式编码的字符串。但某些场景下，Loader不会处理文本文件，而是会处理二进制文件如file-loader，就需要Webpack给Loader传入二进制格式的数据。为此，我们需要这样编写Loader：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 在 exports.raw === true 时，Webpack 传给 Loader 的 source 是 Buffer 类型的</span>
    source <span class="token keyword">instanceof</span> <span class="token class-name">Buffer</span> <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token comment">// Loader 返回的类型也可以是 Buffer 类型的</span>
    <span class="token comment">// 在 exports.raw !== true 时，Loader 也可以返回 Buffer 类型的结果</span>
    <span class="token keyword">return</span> source<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 通过exports.raw属性告诉Webpack该Loader是否需要二进制数据</span>
module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>raw <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>以上代码中最关键的代码是最后一行<code>module.exports.raw = true;</code>，如果没有该行代码，则loader只能拿到字符串。</p> <h2 id="开启loader缓存加速"><a href="#开启loader缓存加速" class="header-anchor">#</a> 开启loader缓存加速</h2> <p>在某些情况下，有些转换操作需要大量的计算，非常耗时，如果每次构建都重新执行重复的转换操作，则构建将会变得非常缓慢。因此，<strong>Webpack会默认缓存所有loader的处理结果</strong>，也就是说：在需要被处理的文件或者其依赖的文件没有发生变化时，是不会重新调用对应的Loader去执行转换操作的。</p> <p>如果我们想让Webpack不缓存该loader的处理结果，可以这样设置：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 关闭loader的缓存功能</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cacheable</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> source<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>缓存条件：loader的结果在相同的输入下有确定的输出。需要注意：有依赖的loader无法使用缓存。</p> <h3 id="loader如何进行文件输出"><a href="#loader如何进行文件输出" class="header-anchor">#</a> loader如何进行文件输出？</h3> <p>可以通过<code>this.emitFile</code>进行文件写入。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> loaderUtils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'loader-utils'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Loader a is excuted!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> url <span class="token operator">=</span> loaderUtils<span class="token punctuation">.</span><span class="token function">interpolateName</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">'[name].[ext]'</span><span class="token punctuation">,</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emitFile</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> source<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="其它loader-api"><a href="#其它loader-api" class="header-anchor">#</a> 其它Loader API</h3> <p>除了以上提到的在<code>Loader</code>中能调用的<code>Webpack API</code>，还存在以下常用 API：</p> <ul><li><strong>this.context</strong>：当前处理文件的所在目录，假如当前 Loader 处理的文件是 /src/main.js，则 this.context 就等于 /src；</li> <li><strong>this.resource</strong>：当前处理的文件的完整请求路径，包括 querystring，例如<code>/src/main.js?name=1</code>；</li> <li><strong>this.resourcePath</strong>：当前处理的文件的路径，例如 /src/main.js；</li> <li><strong>this.resourceQuery</strong>：当前处理的文件的 querystring；</li> <li><strong>this.target</strong>：等于 Webpack 配置中的 Target；</li> <li><strong>this.loadModule</strong>：但Loader 在处理一个文件时，如果依赖其它文件的处理结果才能得出当前文件的结果时，就可以通过this.loadModule(request: string, callback: function(err, source, sourceMap, module)) 去获取request对应文件的处理结果；</li> <li><strong>this.resolve</strong>：像require语句一样获得指定文件的完整路径，使用方法为resolve(context: string, request: string, callback: function(err, result: string))；</li> <li><strong>this.addDependency</strong>：给当前处理文件添加其依赖的文件，以便再其依赖的文件发生变化时，会重新调用 Loader 处理该文件。使用方法为 addDependency(file: string)；</li> <li><strong>this.addContextDependency</strong>：和addDependency 类似，但 addContextDependency 是把整个目录加入到当前正在处理文件的依赖中。使用方法为 addContextDependency(directory: string)；</li> <li><strong>this.clearDependencies</strong>：清除当前正在处理文件的所有依赖，使用方法为 clearDependencies()；</li> <li><strong>this.emitFile</strong>：输出一个文件，使用方法为 emitFile(name: string, content: Buffer|string, sourceMap: {...})。</li></ul> <h2 id="_4种本地开发测试loader的方法-加载本地-loader"><a href="#_4种本地开发测试loader的方法-加载本地-loader" class="header-anchor">#</a> 4种本地开发测试loader的方法(加载本地 Loader)</h2> <p>在开发Loader的过程中，为了测试编写的Loader是否能正常工作，需要把它配置到 Webpack中后，才可能会调用该Loader。在前面的章节中，使用的Loader都是通过npm安装的，要使用Loader时会直接使用Loader的名称，代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>如果还采取以上的方法去使用本地开发的Loader将会很麻烦，因为你需要确保编写的 Loader 的源码是在<code>node_modules</code>目录下。为此你需要先把编写的 Loader发布到Npm仓库后再安装到本地项目使用。</p> <p>解决以上问题的便捷方法有如下几种：</p> <h3 id="匹配单个loader-你可以简单通过在rule对象设置path-resolve指向这个本地文件"><a href="#匹配单个loader-你可以简单通过在rule对象设置path-resolve指向这个本地文件" class="header-anchor">#</a> 匹配单个loader，你可以简单通过在rule对象设置path.resolve指向这个本地文件</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'path/to/loader.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">/* ... */</span><span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="匹配多个loaders-可以使用resolveloader-modules-配置"><a href="#匹配多个loaders-可以使用resolveloader-modules-配置" class="header-anchor">#</a> 匹配多个loaders，可以使用<code>resolveLoader.modules</code> 配置</h3> <p><code>ResolveLoader</code>用于配置<code>Webpack</code>如何寻找<code>Loader</code>。默认情况下，只会去 <code>node_modules</code>目录下寻找，为了让<code>Webpack</code>加载放在本地项目中的<code>Loader</code>需要修改<code>resolveLoader.modules</code>。
<code>webpack</code>将会从这些目录中搜索这些<code>loaders</code>。假如本地的 Loader 在项目目录中的<code>./loaders/loader-name</code>中，则需要如下配置：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  <span class="token literal-property property">resolveLoader</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 去哪些目录下寻找 Loader，有先后顺序之分</span>
    <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">'node_modules'</span><span class="token punctuation">,</span>
      path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'loaders'</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>加上上述配置后，Webpack会先去<code>node_modules</code>项目下寻找<code>Loader</code>，如果找不到，会再去<code>./loaders/</code>目录下寻找。</p> <h3 id="resolveloader-alias"><a href="#resolveloader-alias" class="header-anchor">#</a> resolveLoader.alias</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token literal-property property">resolveLoader</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 给loader配置别名</span>
    <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">'my-loader'</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'loaders'</span><span class="token punctuation">,</span> <span class="token string">'my-loader'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 默认去node_modules目录下找对应的loader，找不到了再去loaders目录下寻找</span>
    <span class="token comment">// 推荐使用</span>
    <span class="token comment">// modules: ['node_modules', path.resolve(__dirname, 'loaders')]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="使用npm-link"><a href="#使用npm-link" class="header-anchor">#</a> 使用<code>npm link</code></h3> <p><code>npm link</code>专门用于开发和调试本地的<code>npm</code>模块，能做到在不发布模块的情况下，将本地的一个正在开发的模块的源码链接到项目的<code>node_modules</code>目录下，让项目可以直接使用本地的Npm模块。由于是通过软链接的方式实现的，编辑了本地的Npm模块代码，所以在项目中也能使用到编辑后的代码。</p> <p>完成<code>npm link</code>的步骤如下：</p> <ol><li>确保正在开发的本地<code>npm</code>模块（也就是正在开发的 Loader）的 <code>package.json</code>已经正确配置好；</li> <li>在本地<code>npm</code>模块根目录下执行<code>npm link</code>，把本地模块注册到全局；</li> <li>在项目根目录下执行<code>npm link loader-name</code>，把第2步注册到全局的本地 Npm 模块链接到项目的<code>node_moduels</code>下，其中的<code>loader-name</code>是指在第1步中的<code>package.json</code>文件中配置的模块名称。</li></ol> <p>链接好<code>Loader</code>到项目后你就可以像使用一个真正的Npm模块一样使用本地的Loader了。</p> <h2 id="loader分类"><a href="#loader分类" class="header-anchor">#</a> loader分类</h2> <ul><li>前置(pre)loader</li> <li>普通(normal)loader</li> <li>后置(post)loader</li> <li>行内(inline)loader</li></ul> <h2 id="配置多个loader"><a href="#配置多个loader" class="header-anchor">#</a> 配置多个loader</h2> <h3 id="数组形式"><a href="#数组形式" class="header-anchor">#</a> 数组形式</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'my-loader3'</span><span class="token punctuation">,</span> <span class="token string">'my-loader2'</span><span class="token punctuation">,</span> <span class="token string">'my-loader'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><img src="/jerry.github.io/assets/img/loader.4ba5468d.png" alt=""></p> <h3 id="对象形式-可以配置loader参数"><a href="#对象形式-可以配置loader参数" class="header-anchor">#</a> 对象形式(可以配置loader参数)</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'my-loader'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'my-loader2'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'my-loader3'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p><img src="/jerry.github.io/assets/img/loader2.7bd8bc60.png" alt=""></p> <h3 id="多个loader执行顺序"><a href="#多个loader执行顺序" class="header-anchor">#</a> 多个loader执行顺序</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>总结：从上面的两个例子中可以看出，多个loader执行顺序是：<strong>多个loader是串行执行的，从右到左，从下到上</strong>。</p></div> <h3 id="配置参数改变loader执行顺序"><a href="#配置参数改变loader执行顺序" class="header-anchor">#</a> 配置参数改变loader执行顺序</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'my-loader'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">enforce</span><span class="token operator">:</span> <span class="token string">'pre'</span> <span class="token comment">// 指定my-loader最先使用</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'my-loader2'</span> <span class="token comment">// 默认为normal</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'my-loader3'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">enforce</span><span class="token operator">:</span> <span class="token string">'post'</span> <span class="token comment">// 最后使用</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>需要注意：loader带参数执行的顺序: pre -&gt; normal -&gt; inline -&gt; post，inline为行内loader。</p></div> <h2 id="inline-loader-行内loader"><a href="#inline-loader-行内loader" class="header-anchor">#</a> inline-loader(行内loader)</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// ./前面的!表示将当前引入的文件交给行内loader处理</span>
<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'inline-loader!./a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 不加限制，所有loader都调用来处理a.js</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code>npx webpack
<span class="token comment">// 输出</span>
my<span class="token operator">-</span>loader1
my<span class="token operator">-</span>loader2
my<span class="token operator">-</span>loader3
my<span class="token operator">-</span>loader1 <span class="token comment">// pre</span>
my<span class="token operator">-</span>loader2 <span class="token comment">// normal</span>
inline<span class="token operator">-</span>loader
my<span class="token operator">-</span>loader3 <span class="token comment">// post</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="禁用normal-loader"><a href="#禁用normal-loader" class="header-anchor">#</a> !禁用normal-loader</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'!inline-loader!./a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// !禁用normal-loader，只使用pre-loader、post-loader和inline-loader处理处理a.js</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code>npx webpack
<span class="token comment">// 输出</span>
my<span class="token operator">-</span>loader1
my<span class="token operator">-</span>loader2
my<span class="token operator">-</span>loader3
my<span class="token operator">-</span>loader1 <span class="token comment">// pre</span>
inline<span class="token operator">-</span>loader
my<span class="token operator">-</span>loader3 <span class="token comment">// post</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="禁用pre-loader和normal-loader"><a href="#禁用pre-loader和normal-loader" class="header-anchor">#</a> -!禁用pre-loader和normal-loader</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'-!inline-loader!./a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// -!禁用pre-loader、normal-loader，只使用post-loader和inline-loader处理处理a.js</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code>npx webpack
<span class="token comment">// 输出</span>
my<span class="token operator">-</span>loader1
my<span class="token operator">-</span>loader2
my<span class="token operator">-</span>loader3
inline<span class="token operator">-</span>loader
my<span class="token operator">-</span>loader3 <span class="token comment">// post</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="禁用pre-loader、normal-loader、post-loader-只能行内处理"><a href="#禁用pre-loader、normal-loader、post-loader-只能行内处理" class="header-anchor">#</a> !!禁用pre-loader、normal-loader、post-loader，只能行内处理</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'!!inline-loader!./a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// !!禁用pre-loader、normal-loader、post-loader，只使用inline-loader处理处理a.js</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code>npx webpack
<span class="token comment">// 输出</span>
my<span class="token operator">-</span>loader1
my<span class="token operator">-</span>loader2
my<span class="token operator">-</span>loader3
inline<span class="token operator">-</span>loader
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="loader组成"><a href="#loader组成" class="header-anchor">#</a> loader组成</h2> <p>loader默认由<strong>pitch和normal</strong>两部分组成。</p> <p>每个loader模块都支持一个<code>.pitch</code>属性，上面的方法会优先于loader的实际方法执行。实际上，webpack官方也给出了pitch与loader本身方法的执行顺序图：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">|</span><span class="token operator">-</span> a<span class="token operator">-</span>loader <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">pitch</span><span class="token template-punctuation string">`</span></span>
  <span class="token operator">|</span><span class="token operator">-</span> b<span class="token operator">-</span>loader <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">pitch</span><span class="token template-punctuation string">`</span></span>
    <span class="token operator">|</span><span class="token operator">-</span> c<span class="token operator">-</span>loader <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">pitch</span><span class="token template-punctuation string">`</span></span>
      <span class="token operator">|</span><span class="token operator">-</span> requested module is picked up <span class="token keyword">as</span> a dependency
    <span class="token operator">|</span><span class="token operator">-</span> c<span class="token operator">-</span>loader normal execution
  <span class="token operator">|</span><span class="token operator">-</span> b<span class="token operator">-</span>loader normal execution
<span class="token operator">|</span><span class="token operator">-</span> a<span class="token operator">-</span>loader normal execution
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>pitch和normal的执行顺序正好相反，当pitch没有定义或者没有返回值时，会先依次执行再获取资源执行loader。如果定义的某个pitch有返回值，则会跳过读取资源和自己的loader。</p> <h3 id="所有loader均无返回值"><a href="#所有loader均无返回值" class="header-anchor">#</a> 所有loader均无返回值</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'my-loader3'</span><span class="token punctuation">,</span> <span class="token string">'my-loader2'</span><span class="token punctuation">,</span> <span class="token string">'my-loader'</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果'my-loader3', 'my-loader2', 'my-loader'3个loader均无返回值，那么先执行<code>pitch</code>方法，从左到右，再获取资源。
<img src="/jerry.github.io/assets/img/loader3.b10dd1bc.png" alt=""></p> <p>所有的pitchLoader都没有返回值。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>pitch   loader3 → loader2 → loader1
                                    ↘
                                      资源
                                    ↙
normal   loader3 ← loader2 ← loader1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code>我是loader3 的pitch
我是loader2 的pitch
我是loader1 的pitch
my<span class="token operator">-</span>loader1
my<span class="token operator">-</span>loader2
my<span class="token operator">-</span>loader3
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="有pitchloader存在返回值"><a href="#有pitchloader存在返回值" class="header-anchor">#</a> 有pitchLoader存在返回值</h3> <p>有返回值：<strong>直接跳过后续所有的loader包括自己的</strong>，跳到之前的loader，可用于阻断loader。
<img src="/jerry.github.io/assets/img/loader4.89565706.png" alt=""></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">loader</span> <span class="token operator">=</span> <span class="token parameter">source</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 当前loader仅仅在源码后面追加了一段文字</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'my-loader2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> source <span class="token operator">+</span> <span class="token string">'我是手写loader处理过的'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

loader<span class="token punctuation">.</span><span class="token function-variable function">pitch</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'我有返回值-阻断了'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> loader<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>输出：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>my<span class="token operator">-</span>loader3
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="loader-runner"><a href="#loader-runner" class="header-anchor">#</a> loader-runner</h2> <p>定义：loader-runner 允许你在不安装 webpack 的情况下运行 loaders。</p> <p>作用：</p> <ul><li>作为 webpack 的依赖，webpack 中使用它执行 loader</li> <li>进行 loader 的开发和调试</li></ul> <h2 id="实战"><a href="#实战" class="header-anchor">#</a> 实战</h2> <p><img src="/jerry.github.io/assets/img/loader6.6f4f7e7d.png" alt=""></p> <p>首先在项目目录下新建loaders目录，用来存放自定义的loader。在loaders目录中新建<code>my-webpack-loader</code>目录，这就是我们的第一个自定义loader，并在该目录下新建index.js和package.json文件。具体内容如下：</p> <p>index.js：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> loaderUtils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'loader-utils'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取用户配置的options</span>
    <span class="token keyword">const</span> options <span class="token operator">=</span> loaderUtils<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'***options***'</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 该loader的作用就是在原内容前加上如下字符串</span>
    <span class="token keyword">return</span> <span class="token string">'{test123};'</span> <span class="token operator">+</span> content<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>package.json：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;my-webpack-loader&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;keywords&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;liujie&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>在webpack.config.js中配置：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'my-webpack-loader'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token string">'wangwu'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>执行<code>npm run dev</code>，结果如下：
<img src="/jerry.github.io/assets/img/loader5.59a5d09c.png" alt=""></p> <h3 id="raw-loader"><a href="#raw-loader" class="header-anchor">#</a> raw-loader</h3> <p><img src="/jerry.github.io/assets/img/image-20200605193224056.03fe265b.png" alt="image-20200605193224056"></p> <ul><li><code>\u2028</code>：行分隔符(行结束符)</li> <li><code>\u2029</code>：段落分隔符(行结束符)</li></ul> <p><code>\u2028</code>为行分隔符，会被浏览器解析为换行，而在Javascript的字符串表达式中是不允许换行的，从而导致错误。</p> <p>把特殊字符转义替换即可，代码如下所示：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>str = str.replace(/\u2028/g, '\\u2028');
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// raw-loader作用：将文件转化为字符串</span>
<span class="token keyword">const</span> loaderUtils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'loader-utils'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>name<span class="token punctuation">}</span> <span class="token operator">=</span> loaderUtils<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取loader参数</span>

    <span class="token keyword">const</span> url <span class="token operator">=</span> loaderUtils<span class="token punctuation">.</span><span class="token function">interpolateName</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">'[name].[ext]'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        source
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取文件名</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emitFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 关闭loader缓存</span>
    <span class="token comment">// this.cacheable(false);</span>
    <span class="token comment">// const callback = this.async();</span>
    <span class="token comment">// console.log('name', name);</span>

    <span class="token comment">// \u2028 行分隔符 \u2029 段落分隔符</span>
    <span class="token keyword">const</span> json <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\u2028</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'\\u2028'</span><span class="token punctuation">)</span> <span class="token comment">// 为了安全起见，处理ES6模板字符串的问题</span>
        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\u2029</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'\\u2029'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ES6模板字符串替换</span>
    <span class="token comment">// 异步loader模拟</span>
    <span class="token comment">// fs.readFile(path.join(__dirname, './async.txt'), 'utf-8', (err, data) =&gt; {</span>
    <span class="token comment">//     if (err) {</span>
    <span class="token comment">//         callback(err, ''); // this.callback方式处理错误</span>
    <span class="token comment">//     }</span>
    <span class="token comment">//     callback(null, data);</span>
    <span class="token comment">// });</span>

    <span class="token comment">// throw new Error('Error'); // throw方式处理错误</span>

    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">export default </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>json<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">666</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span> <span class="token comment">// loader转换后的结果</span>
    <span class="token comment">// loader返回一个值的话可以采用return的方式</span>
    <span class="token comment">// 如果要返回多个值的话就需要采用this.callback的方式了</span>
    <span class="token comment">// this.callback(null, json, 2, 3, 4);</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><h2 id="参考文档"><a href="#参考文档" class="header-anchor">#</a> 参考文档</h2> <ol><li><a href="https://webpack.docschina.org/api/loaders/" target="_blank" rel="noopener noreferrer">loader API<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://segmentfault.com/a/1190000015088834#articleHeader10" target="_blank" rel="noopener noreferrer">webpack原理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://webpack.docschina.org/contribute/writing-a-loader/" target="_blank" rel="noopener noreferrer">编写一个 loader<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://juejin.im/post/5bc1a73df265da0a8d36b74f" target="_blank" rel="noopener noreferrer">【webpack进阶】你真的掌握了loader么？- loader十问<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/CommanderXL/Biu-blog/issues/31" target="_blank" rel="noopener noreferrer">Webpack Loader 高手进阶(一)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2022-05-26 16:21:47</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/jerry.github.io/frontend/webpack/03.Tapable.html" class="prev">
        3.Tapable学习
      </a></span> <span class="next"><a href="/jerry.github.io/frontend/webpack/05.编写自定义plugin.html">
        5.编写自定义plugin
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/jerry.github.io/assets/js/app.8cb867ca.js" defer></script><script src="/jerry.github.io/assets/js/2.7d547363.js" defer></script><script src="/jerry.github.io/assets/js/11.230bdafc.js" defer></script><script src="/jerry.github.io/assets/js/20.cf42ebc2.js" defer></script>
  </body>
</html>
